version: '3'

services:
        uwsgi:
                build: .
                links:
                        - postgres
                command: ./uwsgi.sh
                volumes:
                        - /static
                        - /data/media:/media
                links: web
        nginx:
                image: nginx
                links:
                        - uwsgi
                volumes_from:
                        - uwsgi
                ports:
                        - "0.0.0.0:80:80"
                command: /bin/bash && nginx -g 'daemon off;'
                volumes:
                        - /static
                        - ./src:/src
                        - ./config/nginx:/etc/nginx/conf.d
        web:
                build: .
                command: python manage.py runserver 0.0.0.0:8000
                volumes:
                        - .:/web
                expose:
                        - "8000"
                depends_on:
                        - db
        db:
                image: postgres:10
                environment:
                        POSTGRES_DB: "database"
                        POSTGRES_USER: "postgres"
                        POSTGRES_PASSWORD: "postgres"
                ports:
                        - 5432:5432
                volumes:
                        - ~/docker/postgres:/var/lib/postgresql/data
